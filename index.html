<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Keyed Vigenère Cipher</title>

<style>
  body {
    background: #0e0e0e;
    color: white;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .container {
    width: 420px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  input, textarea, button {
    padding: 10px;
    font-size: 15px;
  }

  textarea {
    resize: none;
    height: 80px;
    flex: 1;
  }

  button {
    cursor: pointer;
  }

  .output-row {
    display: flex;
    gap: 6px;
  }

  .copy-btn {
    width: 90px;
  }
</style>
</head>

<body>
<div class="container">
  <h2>Keyed Vigenère Cipher</h2>

  <label>
    <input type="checkbox" id="useAlphabetKey">
    Use alphabet keyword
  </label>

  <input id="alphabetKey" placeholder="Alphabet keyword" disabled>
  <input id="cipherKey" placeholder="Cipher keyword (required)">
  <textarea id="inputText" placeholder="Enter text"></textarea>

  <button onclick="encrypt()">Encrypt</button>
  <button onclick="decrypt()">Decrypt</button>

  <div class="output-row">
    <textarea id="outputText" placeholder="Result" readonly></textarea>
    <button class="copy-btn" onclick="copyOutput()">Copy</button>
  </div>
</div>

<script>
document.getElementById("useAlphabetKey").addEventListener("change", e => {
  document.getElementById("alphabetKey").disabled = !e.target.checked;
});

function createAlphabet(keyword, useKeyword) {
  if (!useKeyword || !keyword) return "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

  keyword = keyword.toUpperCase().replace(/[^A-Z]/g, "");
  let seen = new Set();
  let result = "";

  for (let c of keyword) {
    if (!seen.has(c)) {
      seen.add(c);
      result += c;
    }
  }

  for (let i = 65; i <= 90; i++) {
    let c = String.fromCharCode(i);
    if (!seen.has(c)) result += c;
  }

  return result;
}

function buildGrid(alphabet) {
  let grid = [];
  for (let i = 0; i < 26; i++) {
    grid.push(alphabet.slice(i) + alphabet.slice(0, i));
  }
  return grid;
}

function encrypt() {
  processText(true);
}

function decrypt() {
  processText(false);
}

function processText(isEncrypt) {
  const rawText = document.getElementById("inputText").value;
  const rawCipherKey = document.getElementById("cipherKey").value;
  const alphabetKey = document.getElementById("alphabetKey").value;
  const useAlphabetKey = document.getElementById("useAlphabetKey").checked;

  const text = rawText.toUpperCase().replace(/[^A-Z]/g, "");
  const cipherKey = rawCipherKey.toUpperCase().replace(/[^A-Z]/g, "");

  if (!cipherKey.length) {
    alert("Cipher keyword must contain letters A–Z.");
    return;
  }

  const alphabet = createAlphabet(alphabetKey, useAlphabetKey);
  const grid = buildGrid(alphabet);

  let result = "";
  let keyIndex = 0;

  for (let char of text) {
    const row = alphabet.indexOf(cipherKey[keyIndex % cipherKey.length]);

    if (isEncrypt) {
      const col = alphabet.indexOf(char);
      result += grid[row][col];
    } else {
      const col = grid[row].indexOf(char);
      result += alphabet[col];
    }

    keyIndex++;
  }

  document.getElementById("outputText").value = result;
}

function copyOutput() {
  const output = document.getElementById("outputText");
  if (!output.value) return;

  navigator.clipboard.writeText(output.value).then(() => {
    const btn = document.querySelector(".copy-btn");
    const original = btn.textContent;
    btn.textContent = "Copied!";
    setTimeout(() => btn.textContent = original, 1200);
  });
}
</script>
</body>
</html>
